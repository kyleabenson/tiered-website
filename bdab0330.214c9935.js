(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{151:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(9),i=(n(0),n(159)),o={id:"azure",title:"Azure",sidebar_label:"Azure"},l={id:"azure",title:"Azure",description:"# Azure Deployment",source:"@site/docs/azure.md",permalink:"/tiered-website/docs/azure",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/azure.md",sidebar_label:"Azure",sidebar:"someSidebar",previous:{title:"Amazon Web Services",permalink:"/tiered-website/docs/aws"},next:{title:"Google Cloud Platform",permalink:"/tiered-website/docs/gcp"}},s=[{value:"Prerequisities",id:"prerequisities",children:[]},{value:"Notes",id:"notes",children:[]},{value:"Presentation Layer",id:"presentation-layer",children:[{value:"Provisioning the 3 VMs",id:"provisioning-the-3-vms",children:[]}]},{value:"Application",id:"application",children:[{value:"Provisioning the application layer",id:"provisioning-the-application-layer",children:[]}]},{value:"Database",id:"database",children:[]},{value:"Load Balancer",id:"load-balancer",children:[]},{value:"Tips",id:"tips",children:[]}],c={rightToc:s};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"azure-deployment"},"Azure Deployment"),Object(i.b)("p",null,"Deploying a traditional 3 tier application to Azure is a common way people get started with cloud providers. This model, often known as ",Object(i.b)("em",{parentName:"p"},"lift and shift")," allows you to quickly get started in the cloud using traditional deployment paradigms, without necessarily taking advantage of cloud optimized features."),Object(i.b)("p",null,"At the end of this exercise, we'll have installed a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#"}),"TO DO simple web app")," across this environment."),Object(i.b)("hr",null),Object(i.b)("h2",{id:"prerequisities"},"Prerequisities"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Install Prerequisites for using Ansible with Azure"),"\n",Object(i.b)("inlineCode",{parentName:"p"},"pip install 'ansible[azure]'"),Object(i.b)("br",{parentName:"p"}),"\n",Object(i.b)("inlineCode",{parentName:"p"},"ansible-galaxy collection install azure.azcollection"),Object(i.b)("br",{parentName:"p"}),"\n",Object(i.b)("strong",{parentName:"p"},"Login to Azure CLI"),Object(i.b)("br",{parentName:"p"}),"\n","The easiest way to do this is to follow Microsoft's guide for logging in:\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest"}),"Login to Azure CLI"),Object(i.b)("br",{parentName:"p"}),"\n","If preferred you can also store credentials in ",Object(i.b)("inlineCode",{parentName:"p"}," ~/.azure/credentials"),"  "),Object(i.b)("h2",{id:"notes"},"Notes"),Object(i.b)("p",null,"All configuration options are stored in the ",Object(i.b)("inlineCode",{parentName:"p"},"config.yml")," file at the top level of this project, which will allow you configure usernamers, resource groups, etc.   "),Object(i.b)("h2",{id:"presentation-layer"},"Presentation Layer"),Object(i.b)("p",null,"For the purposes of this lab we're going to build 3 presentation layer nodes, which will be setup in a round-robin fashion behind the load balancer. We could also setup monitoring capabilties to scale up VM count based on certain performance or load metrics, but we'll set that aside for now."),Object(i.b)("h3",{id:"provisioning-the-3-vms"},"Provisioning the 3 VMs"),Object(i.b)("p",null,"The easiest way to do this, rather than creating individual VMs, is to use the ",Object(i.b)("inlineCode",{parentName:"p"},"azure_rm_virtualmachinescaleset")," module which will automatically create the defined amount of VMs from the same standards. Since we're creating 3 to start, it will look like this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'    - name: Create Presentation Layer virtual machine scaling set\n      azure_rm_virtualmachinescaleset:\n            resource_group: "{{ azure_resource_group }}"\n            name: testvmss\n            vm_size: Standard_DS1_v2\n            capacity: 3\n            virtual_network_name: "{{ azure_network_name }}"\n            upgrade_policy: Manual\n            load_balancer: test_lb\n            subnet_name: default\n            admin_username: "{{ admin_user }}"\n            ssh_password_enabled: false\n            ssh_public_keys:\n            - path: "/home/{{ admin_user }}/.ssh/authorized_keys"\n              key_data: \n            managed_disk_type: Standard_LRS\n            image:\n                offer: RHEL\n                publisher: RedHat\n                sku: 8.1\n                version: latest\n            data_disks:\n            - lun: 0\n              disk_size_gb: 64\n              caching: ReadWrite\n              managed_disk_type: Standard_LRS\n')),Object(i.b)("h2",{id:"application"},"Application"),Object(i.b)("p",null,"The business or application layer for this exercise is just a single node, although you could expand and place a load balancer here if needed for scaling constraints"),Object(i.b)("h3",{id:"provisioning-the-application-layer"},"Provisioning the application layer"),Object(i.b)("p",null,"Since we only need a single system for our business logic in this example, we'll create a single VM that we'll install our middleware onto. "),Object(i.b)("h2",{id:"database"},"Database"),Object(i.b)("p",null,"The database will be a hosted offering on Azure, which reduces some of the complexity and maintenance of this app"),Object(i.b)("h2",{id:"load-balancer"},"Load Balancer"),Object(i.b)("p",null,"The load balancer will also be a hosted offering on Azure, again to reduce the complexities of maintenance but allowing for us to instantiate, modify, and destroy with Ansible in a relatively easy fashion."),Object(i.b)("h2",{id:"tips"},"Tips"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Using UI Based Resources for help"),Object(i.b)("br",{parentName:"p"}),"\n",Object(i.b)("inlineCode",{parentName:"p"},"download template for automation")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Jump Host Configuration"),Object(i.b)("br",{parentName:"p"}),"\n","Rather than expose the public IPs of all the servers for SSH, we can create a jump or bastion host and have Ansible connect through a single host, reducing the surface area of future attackss\nTODO"))}p.isMDXComponent=!0},159:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},u=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,h=u["".concat(o,".").concat(d)]||u[d]||b[d]||i;return n?r.a.createElement(h,l({ref:t},c,{components:n})):r.a.createElement(h,l({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);