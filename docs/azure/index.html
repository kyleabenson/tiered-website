<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">Azure | Ansible for N-Tier Webapp Deployments</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Azure | Ansible for N-Tier Webapp Deployments"><meta data-react-helmet="true" name="description" content="# Azure Deployment"><meta data-react-helmet="true" property="og:description" content="# Azure Deployment"><meta data-react-helmet="true" property="og:url" content="https://kyleabenson.github.io/tiered-website/tiered-website/docs/azure">

<link data-react-helmet="true" rel="shortcut icon" href="/tiered-website/img/favicon.ico">


<link rel="stylesheet" href="/tiered-website/styles.273885d5.css">


<link rel="preload" href="/tiered-website/styles.77a41af3.js" as="script">

<link rel="preload" href="/tiered-website/runtime~main.88a59206.js" as="script">

<link rel="preload" href="/tiered-website/main.b46ab0b8.js" as="script">

<link rel="preload" href="/tiered-website/1.ec644f8d.js" as="script">

<link rel="preload" href="/tiered-website/2.4c4c9348.js" as="script">

<link rel="preload" href="/tiered-website/20.4f78e627.js" as="script">

<link rel="preload" href="/tiered-website/39b4e302.6884ff92.js" as="script">

<link rel="preload" href="/tiered-website/17896441.4c0ae586.js" as="script">

<link rel="preload" href="/tiered-website/bdab0330.214c9935.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/tiered-website/"><img class="navbar__logo" src="/tiered-website/img/redhat.png" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tiered-website/docs/overview">Docs</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/tiered-website/"><img class="navbar__logo" src="/tiered-website/img/redhat.png" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/tiered-website/docs/overview">Docs</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tiered-website/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tiered-website/docs/presentation">Presentation Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tiered-website/docs/bizlogic">Business Logic Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tiered-website/docs/db">Database Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tiered-website/docs/lb">Load Balancer</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Supported Clouds</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tiered-website/docs/aws">Amazon Web Services</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/tiered-website/docs/azure">Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tiered-website/docs/gcp">Google Cloud Platform</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Azure</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="azure-deployment"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-deployment" title="Direct link to heading">#</a>Azure Deployment</h1><p>Deploying a traditional 3 tier application to Azure is a common way people get started with cloud providers. This model, often known as <em>lift and shift</em> allows you to quickly get started in the cloud using traditional deployment paradigms, without necessarily taking advantage of cloud optimized features.</p><p>At the end of this exercise, we&#x27;ll have installed a <a href="#">TO DO simple web app</a> across this environment.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="prerequisities"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisities" title="Direct link to heading">#</a>Prerequisities</h2><p><strong>Install Prerequisites for using Ansible with Azure</strong>
<code>pip install &#x27;ansible[azure]&#x27;</code><br>
<code>ansible-galaxy collection install azure.azcollection</code><br>
<strong>Login to Azure CLI</strong><br>
The easiest way to do this is to follow Microsoft&#x27;s guide for logging in:
<a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Login to Azure CLI</a><br>
If preferred you can also store credentials in <code> ~/.azure/credentials</code>  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#notes" title="Direct link to heading">#</a>Notes</h2><p>All configuration options are stored in the <code>config.yml</code> file at the top level of this project, which will allow you configure usernamers, resource groups, etc.   </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="presentation-layer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#presentation-layer" title="Direct link to heading">#</a>Presentation Layer</h2><p>For the purposes of this lab we&#x27;re going to build 3 presentation layer nodes, which will be setup in a round-robin fashion behind the load balancer. We could also setup monitoring capabilties to scale up VM count based on certain performance or load metrics, but we&#x27;ll set that aside for now.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="provisioning-the-3-vms"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#provisioning-the-3-vms" title="Direct link to heading">#</a>Provisioning the 3 VMs</h3><p>The easiest way to do this, rather than creating individual VMs, is to use the <code>azure_rm_virtualmachinescaleset</code> module which will automatically create the defined amount of VMs from the same standards. Since we&#x27;re creating 3 to start, it will look like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - name: Create Presentation Layer virtual machine scaling set</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      azure_rm_virtualmachinescaleset:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            resource_group: &quot;{{ azure_resource_group }}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            name: testvmss</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            vm_size: Standard_DS1_v2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            capacity: 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            virtual_network_name: &quot;{{ azure_network_name }}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            upgrade_policy: Manual</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            load_balancer: test_lb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            subnet_name: default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            admin_username: &quot;{{ admin_user }}&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ssh_password_enabled: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ssh_public_keys:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - path: &quot;/home/{{ admin_user }}/.ssh/authorized_keys&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              key_data: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            managed_disk_type: Standard_LRS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            image:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                offer: RHEL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                publisher: RedHat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                sku: 8.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                version: latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            data_disks:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - lun: 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              disk_size_gb: 64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              caching: ReadWrite</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              managed_disk_type: Standard_LRS</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="application"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#application" title="Direct link to heading">#</a>Application</h2><p>The business or application layer for this exercise is just a single node, although you could expand and place a load balancer here if needed for scaling constraints</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="provisioning-the-application-layer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#provisioning-the-application-layer" title="Direct link to heading">#</a>Provisioning the application layer</h3><p>Since we only need a single system for our business logic in this example, we&#x27;ll create a single VM that we&#x27;ll install our middleware onto. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="database"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#database" title="Direct link to heading">#</a>Database</h2><p>The database will be a hosted offering on Azure, which reduces some of the complexity and maintenance of this app</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="load-balancer"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#load-balancer" title="Direct link to heading">#</a>Load Balancer</h2><p>The load balancer will also be a hosted offering on Azure, again to reduce the complexities of maintenance but allowing for us to instantiate, modify, and destroy with Ansible in a relatively easy fashion.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="tips"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#tips" title="Direct link to heading">#</a>Tips</h2><p><strong>Using UI Based Resources for help</strong><br>
<code>download template for automation</code></p><p><strong>Jump Host Configuration</strong><br>
Rather than expose the public IPs of all the servers for SSH, we can create a jump or bastion host and have Ansible connect through a single host, reducing the surface area of future attackss
TODO</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/azure.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tiered-website/docs/aws"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Amazon Web Services</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tiered-website/docs/gcp"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Google Cloud Platform »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#prerequisities" class="contents__link">Prerequisities</a></li><li><a href="#notes" class="contents__link">Notes</a></li><li><a href="#presentation-layer" class="contents__link">Presentation Layer</a><ul><li><a href="#provisioning-the-3-vms" class="contents__link">Provisioning the 3 VMs</a></li></ul></li><li><a href="#application" class="contents__link">Application</a><ul><li><a href="#provisioning-the-application-layer" class="contents__link">Provisioning the application layer</a></li></ul></li><li><a href="#database" class="contents__link">Database</a></li><li><a href="#load-balancer" class="contents__link">Load Balancer</a></li><li><a href="#tips" class="contents__link">Tips</a></li></ul></div></div></div></div></main></div></div>
</div>

<script src="/tiered-website/styles.77a41af3.js"></script>

<script src="/tiered-website/runtime~main.88a59206.js"></script>

<script src="/tiered-website/main.b46ab0b8.js"></script>

<script src="/tiered-website/1.ec644f8d.js"></script>

<script src="/tiered-website/2.4c4c9348.js"></script>

<script src="/tiered-website/20.4f78e627.js"></script>

<script src="/tiered-website/39b4e302.6884ff92.js"></script>

<script src="/tiered-website/17896441.4c0ae586.js"></script>

<script src="/tiered-website/bdab0330.214c9935.js"></script>


</body>
</html>